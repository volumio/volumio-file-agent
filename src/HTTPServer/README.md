# HTTP Server

The Agent's HTTP server provides an interface to control the Agent itself and perform queries about its mantained list of MediaFiles.

The server's endponts are developed and documented according to the [OpenApi Specification](https://www.openapis.org/) standard.

This allows us to have a better and easier **developer experience** which mainly revolves around the idea of having _`code as the single point of truth`_.

## Development iteration flow and DEX

The first time-saver for API consumption (if you are hacking the Volumio Core) and one of the thing that we want to strictly maintain is the API documentation.

Even if the HTTP protocol itself does not come with any concept of [_typization_](https://en.wikipedia.org/wiki/Type_system), projects like OpenApi Specification try to provide some tooling to bring the _API schema_ concept to the table so we (the devs), can give ourselves some automation and compile time check in order to simplify and speed up our daily work.

### Define the API shape and browse (live) it's documentation

Thanks to the [spot](https://www.npmjs.com/package/@airtasker/spot) library, we can describe our API endpoints simply through typescript files contained in `src/HTTPServer/OpenApiBackend/contract/endpoints`.

`spot`'s job is to be able to look at those typescript contracts, trasform them in an OpenApiV3 json strcuture and provide us a UI to browse our APIs.

Just run:

```bash
npm run openApi:doc
```

and point your browser at `http://localhost:8080` to see the outcome.

### Implement the API specification in code

Thanks to the [openapi-backend](https://www.npmjs.com/package/openapi-backend) library we can use our OpenApi defined contract to instantiate a request handler which conforms to the spec. We need to have it in a JSON file specification.

The `spot` webserver exposes our OpenApiV3 json at `http://localhost:8080/contract-openapi3`.

Running

```bash
npm run openApi:make-spec
```

you instruct `spot` to re-evaluate our `src/HTTPServer/OpenApiBackend/contract.ts` file; then the corrsponding `contract.json` file will be written at `src/HTTPServer/OpenApiBackend/contract.json`.

**Note:** the `contract.json` file is autogenerated, thus it should not be committed. It gets also generated during the `npm run build` process.
